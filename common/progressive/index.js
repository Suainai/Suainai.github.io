class ProgressiveLoad{constructor(e,t){this.smallSrc=e,this.largeSrc=t,this.initScrollListener(),this.initTpl()}initScrollListener(){window.addEventListener("scroll",(()=>{var e=Math.min(window.scrollY/window.innerHeight,1);this.container.style.setProperty("--process",e)}))}initTpl(){this.container=document.createElement("div"),this.smallStage=document.createElement("div"),this.largeStage=document.createElement("div"),this.video=document.createElement("div"),this.smallImg=new Image,this.largeImg=new Image,this.container.className="pl-container",this.container.style.setProperty("--process",0),this.smallStage.className="pl-img pl-blur",this.largeStage.className="pl-img",this.video.className="pl-video",this.container.appendChild(this.smallStage),this.container.appendChild(this.largeStage),this.container.appendChild(this.video),this.smallImg.onload=this._onSmallLoaded.bind(this),this.largeImg.onload=this._onLargeLoaded.bind(this)}progressiveLoad(){this.smallImg.src=this.smallSrc,this.largeImg.src=this.largeSrc}_onLargeLoaded(){this.largeStage.classList.add("pl-visible"),this.largeStage.style.backgroundImage=`url('${this.largeSrc}')`}_onSmallLoaded(){this.smallStage.classList.add("pl-visible"),this.smallStage.style.backgroundImage=`url('${this.smallSrc}')`}}const executeLoad=(e,t)=>{console.log("执行渐进背景替换");const i=window.matchMedia("(max-width: 767px)").matches,a=new ProgressiveLoad(i?e.mobileSmallSrc:e.smallSrc,i?e.mobileLargeSrc:e.largeSrc);t.children[0]&&t.insertBefore(a.container,t.children[0]),a.progressiveLoad()},config={smallSrc:"/common/bg-max.jpg",largeSrc:"/common/bg-max.jpg",mobileSmallSrc:"/common/bg-max.jpg",mobileLargeSrc:"/common/bg-max.jpg",enableRoutes:["/"]};function initProgressiveLoad(e){const t=document.querySelector(".pl-container");t&&t.remove();const i=document.getElementById("page-header");i&&i.classList.contains("full_page")&&executeLoad(e,i)}function onPJAXComplete(e){const t=document.getElementById("page-header");t&&t.classList.contains("full_page")&&initProgressiveLoad(e)}document.addEventListener("DOMContentLoaded",(function(){initProgressiveLoad(config)})),document.addEventListener("pjax:complete",(function(){onPJAXComplete(config)}));