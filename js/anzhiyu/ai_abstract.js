(()=>{let e,t,{randomNum:i,basicWordCount:n,btnLink:a,key:r,Referer:l,gptName:o,switchBtn:s,mode:c}=GLOBAL_CONFIG.postHeadAiDescription,{title:d,postAI:m,pageFillDescription:y}=GLOBAL_CONFIG_SITE,u=-1,h=!0,p=c,f=0,g=null,T=!1,v=null,b=document.querySelector(".post-ai-description"),E=b.querySelector(".ai-title .anzhiyufont.anzhiyu-icon-arrow-rotate-right"),k=b.querySelector(".anzhiyu-icon-circle-dot"),L=b.querySelector(".ai-explanation"),M="",I="",A=0,S=0,q=[],w=0,G=new IntersectionObserver((e=>{e=e[0].isIntersecting,(h=e)&&(t=0===A?200:20,q[1]=setTimeout((()=>{S&&(A=0,S=0),0===A&&(L.innerHTML=M.charAt(0)),requestAnimationFrame(P)}),t))}),{threshold:0}),x=[function(){$("tianli"==p?"我是文章辅助AI: TianliGPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。":`我是文章辅助AI: ${o} GPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。`)},function(){E.click()},function(){A=0,S=1,j(),h=!1,w=0,L.innerHTML="生成中. . .",M="",I="",G.disconnect(),q[2]=setTimeout((()=>{L.innerHTML=(()=>{let e=document.querySelectorAll(".relatedPosts-list a");if(!e.length){var t=document.querySelector(".card-widget.card-recent-post");if(!t)return"";e=t.querySelectorAll(".aside-list-item a");let n="";for(let t=0;t<e.length;t++){var i=e[t];n+=`<div class="ai-recommend-item"><span class="index">${t+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${i.href}')" title="${i.title}" data-pjax-state="">${i.title}</a></div>`}return`很抱歉，无法找到类似的文章，你也可以看看本站最新发布的文章：<br /><div class="ai-recommend">${n}</div>`}let n="";for(let t=0;t<e.length;t++){var a=e[t];n+=`<div class="ai-recommend-item"><span>推荐${t+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${a.href}')" title="${a.title}" data-pjax-state="">${a.title}</a></div>`}return`推荐文章：<br /><div class="ai-recommend">${n}</div>`})()}),600)},function(){$("正在前往博客主页...",!1),q[2]=setTimeout((()=>{window.pjax?pjax.loadUrl("/"):location.href=location.origin}),1e3)}];var B=b.querySelectorAll(".ai-btn-item");function P(e){var t;h&&(P.start||(P.start=e),20<=(w=e-P.start)?(P.start=e,A<I-1&&(e=M.charAt(A+1),t=/[,.，。!?！？]/.test(e)?150:20,L.firstElementChild&&L.removeChild(L.firstElementChild),L.innerHTML+=e,(e=document.createElement("div")).className="ai-cursor",L.appendChild(e),A++,150==t&&(b.querySelector(".ai-explanation .ai-cursor").style.opacity="0.2"),A===I-1&&(G.disconnect(),L.removeChild(L.firstElementChild)),q[0]=setTimeout((()=>{requestAnimationFrame(P)}),t))):requestAnimationFrame(P))}function j(){q.length&&q.forEach((e=>{e&&clearTimeout(e)}))}function $(e,t=!0){A=0,S=1,j(),h=!1,w=0,G.disconnect(),L.innerHTML=t?"生成中. . .":"请等待. . .",M=e,I=M.length,G.observe(b)}async function C(e=n){if("tianli"===p){A=0,S=1,j(),h=!1,w=0,G.disconnect(),e=Math.max(10,Math.min(2e3,e));var t={key:r,Referer:l},i=(e=(d+y).trim().substring(0,e),{key:t.key,content:e,url:location.href});t={method:"POST",headers:{"Content-Type":"application/json",Referer:t.Referer},body:JSON.stringify(i)},console.info(e.length);try{a=setInterval((()=>{var e="生成中"+".".repeat(S);L.innerHTML=e,S=S%3+1}),500);var a,o,s=await fetch("https://summary.tianli0.top/",t);let e;e=403===s.status?{summary:"403 refer与key不匹配。"}:500===s.status?{summary:"500 系统内部错误"}:await s.json(),o=e.summary.trim(),v=e.id,setTimeout((()=>{E.style.opacity="1"}),300),$(o||"摘要获取失败!!!请检查Tianli服务是否正常!!!"),clearInterval(a)}catch(e){console.error(e),L.innerHTML="发生异常"+e}}else{var c=m.split(",").map((e=>e.trim()));if(1!==c.length){let e=Math.floor(Math.random()*c.length);for(;e===u;)e=Math.floor(Math.random()*c.length);u=e,$(c[e])}else $(c[0]);setTimeout((()=>{E.style.opacity="1"}),600)}}Array.from(B).filter((e=>"go-tianli-blog"!==e.id)).forEach(((e,t)=>{e.addEventListener("click",(()=>{x[t]()}))})),document.getElementById("ai-tag").addEventListener("click",(function(){"tianli"===p?(b.querySelectorAll(".ai-btn-item").forEach((e=>e.style.display="none")),document.getElementById("go-tianli-blog").style.display="block",$("你好，我是Tianli开发的摘要生成助理TianliGPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通，如果你也需要一个这样的AI摘要接口，可以在下方购买。")):(b.querySelectorAll(".ai-btn-item").forEach((e=>e.style.display="block")),document.getElementById("go-tianli-blog").style.display="none",$(`你好，我是本站摘要生成助理${o} GPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通。`))})),E.addEventListener("click",(function(){var t=(d+y).trim().substring(0,n);if(E.style.opacity="0.2",E.style.transitionDuration="0.3s",E.style.transform="rotate("+360*f+"deg)",t.length<=n){let n=t.length-Math.floor(Math.random()*i);for(;n===e||t.length-n===e;)n=t.length-Math.floor(Math.random()*i);C(e=n)}else{let a=Math.floor(Math.random()*i)+n;for(;a===e||t.length-a===e;)a=Math.floor(Math.random()*i)+n;C(a)}f++})),document.getElementById("go-tianli-blog").addEventListener("click",(()=>{window.open(a,"_blank")})),k.addEventListener("click",(async function(){if(v)if((k=b.querySelector(".anzhiyu-icon-circle-dot")).style.opacity="0.2",g&&!T)g.pause(),T=!0,k.style.opacity="1",k.style.animation="",k.style.cssText="animation: ''; opacity: 1;cursor: pointer;";else if(g&&T)g.play(),T=!1,k.style.cssText="animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer";else{var e={key:r,Referer:l},t=new URLSearchParams({key:e.key,id:v});e={method:"GET",headers:{"Content-Type":"application/json",Referer:e.Referer}};try{var i,n,a=await fetch("https://summary.tianli0.top/audio?"+t,e);403===a.status?console.error("403 refer与key不匹配。"):500===a.status?console.error("500 系统内部错误"):(i=await a.blob(),n=URL.createObjectURL(i),(g=new Audio(n)).play(),k.style.cssText="animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer",g.addEventListener("ended",(()=>{g=null,k.style.opacity="1",k.style.animation=""})))}catch(e){console.error("请求发生错误❎")}}else anzhiyu.snackbarShow("摘要还没加载完呢，请稍后。。。")})),s&&document.getElementById("ai-Toggle").addEventListener("click",(function(){"tianli"==(p="tianli"===p?"local":"tianli")?(document.getElementById("ai-tag").innerHTML="TianliGPT",k.style.opacity="1",k.style.cursor="pointer"):(k.style.opacity="0",k.style.cursor="auto",document.getElementById("go-tianli-blog").style.display="block",document.querySelectorAll(".ai-btn-item").forEach((e=>e.style.display="block")),document.getElementById("go-tianli-blog").style.display="none",document.getElementById("ai-tag").innerHTML=o+" GPT"),C()})),C(),document.getElementById("ai-tag").innerHTML="tianli"===p?"TianliGPT":o+" GPT"})();