rm={};let aElements=document.getElementsByTagName("a");for(let e=0;e<aElements.length;e++){aElements[e].setAttribute("draggable","false");let t=aElements[e].getElementsByTagName("img");for(let e=0;e<t.length;e++)t[e].setAttribute("draggable","false")}rm.showRightMenu=function(e,t=0,n=0){console.info(t,n);var i=document.getElementById("rightMenu");i.style.top=t+"px",i.style.left=n+"px",e?(i.style.display="block",stopMaskScroll()):i.style.display="none"},rm.hideRightMenu=function(){rm.showRightMenu(!1),document.querySelector("#rightmenu-mask").style.display="none"};let rmWidth=document.getElementById("rightMenu").offsetWidth,rmHeight=document.getElementById("rightMenu").offsetHeight,domhref=(rm.reloadrmSize=function(){rightMenu.style.visibility="hidden",rightMenu.style.display="block",rmWidth=document.getElementById("rightMenu").offsetWidth,rmHeight=document.getElementById("rightMenu").offsetHeight,rightMenu.style.visibility="visible"},""),domImgSrc="",globalEvent=null;var oncontextmenuFunction=function(e){if(768<document.body.clientWidth){let k=e.clientX+10,v=e.clientY;var t=document.querySelector(".rightMenuOther"),n=document.querySelector(".rightMenuPlugin"),i=document.querySelector("#menu-copytext"),o=document.querySelector("#menu-pastetext"),c=document.querySelector("#menu-commenttext"),l=document.querySelector("#menu-newwindow"),m=document.querySelector("#menu-newwindowimg"),d=document.querySelector("#menu-copylink"),u=document.querySelector("#menu-copyimg"),r=document.querySelector("#menu-downloadimg"),a=document.querySelector("#menu-search"),s=document.querySelector("#menu-searchBaidu"),y=document.querySelector("#menu-music-toggle"),g=document.querySelector("#menu-music-back"),h=document.querySelector("#menu-music-forward"),p=document.querySelector("#menu-music-playlist"),w=document.querySelector("#menu-music-copyMusicName"),E=e.target.href,f=e.target.currentSrc;let b=!1;return t.style.display="block",globalEvent=e,selectTextNow&&window.getSelection()?(b=!0,i.style.display="block",c.style.display="block",a.style.display="block",s.style.display="block"):(i.style.display="none",c.style.display="none",s.style.display="none",a.style.display="none"),E?(b=!0,l.style.display="block",d.style.display="block",domhref=E):(l.style.display="none",d.style.display="none"),f?(b=!0,u.style.display="block",r.style.display="block",m.style.display="block",document.getElementById("rightMenu").style.width="12rem",domImgSrc=f):(u.style.display="none",r.style.display="none",m.style.display="none"),"input"===e.target.tagName.toLowerCase()||"textarea"===e.target.tagName.toLowerCase()?(b=!0,o.style.display="block"):o.style.display="none",(i=document.querySelector("#nav-music"))&&i.contains(e.target)?(b=!0,y.style.display="block",g.style.display="block",h.style.display="block",p.style.display="block",w.style.display="block"):(y.style.display="none",g.style.display="none",h.style.display="none",p.style.display="none",w.style.display="none"),b?(t.style.display="none",n.style.display="block"):n.style.display="none",rm.reloadrmSize(),k+rmWidth>window.innerWidth&&(k-=rmWidth+10),v+rmHeight>window.innerHeight&&(v-=v+rmHeight-window.innerHeight),rm.showRightMenu(!0,v,k),!(document.getElementById("rightmenu-mask").style.display="flex")}};function imageToBlob(e){let t=new Image,n=document.createElement("canvas"),i=n.getContext("2d");return t.crossOrigin="",t.src=e,new Promise((e=>{t.onload=function(){n.width=this.naturalWidth,n.height=this.naturalHeight,i.drawImage(this,0,0),n.toBlob((t=>{e(t)}),"image/png",.75)}}))}async function copyImage(e){e=await imageToBlob(e),e=new ClipboardItem({"image/png":e}),navigator.clipboard.write([e])}function stopMaskScroll(){document.getElementById("rightmenu-mask")&&document.getElementById("rightmenu-mask").addEventListener("mousewheel",(function(e){rm.hideRightMenu()}),{passive:!0}),document.getElementById("rightMenu")&&document.getElementById("rightMenu").addEventListener("mousewheel",(function(e){rm.hideRightMenu()}),{passive:!0})}window.oncontextmenu=oncontextmenuFunction,rm.downloadimging=!1,rm.writeClipImg=function(e){console.log("按下复制"),rm.hideRightMenu(),anzhiyu.snackbarShow("正在下载中，请稍后",!1,1e4),0==rm.downloadimging&&(rm.downloadimging=!0,setTimeout((function(){copyImage(e),anzhiyu.snackbarShow("复制成功！图片已添加盲水印，请遵守版权协议"),rm.downloadimging=!1}),"10000"))},rm.copyUrl=function(e){var t=document.createElement("input");t.id="copyVal",document.body.appendChild(t),t.value=e,t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),t.remove()},rm.rightmenuCopyText=function(e){navigator.clipboard&&navigator.clipboard.writeText(e),rm.hideRightMenu()},rm.copyPageUrl=function(e){e=e||window.location.href,rm.copyUrl(e),anzhiyu.snackbarShow("复制链接地址成功",!1,2e3),rm.hideRightMenu()};var selectTextNow="";function selceText(){var e=document.selection?document.selection.createRange().text:window.getSelection().toString();selectTextNow=""!==e?e:""}function replaceAll(e,t,n){return e.split(t).join(n)}function addRightMenuClickEvent(){document.getElementById("menu-backward").addEventListener("click",(function(){window.history.back(),rm.hideRightMenu()})),document.getElementById("menu-forward").addEventListener("click",(function(){window.history.forward(),rm.hideRightMenu()})),document.getElementById("menu-refresh").addEventListener("click",(function(){window.location.reload()})),document.getElementById("menu-top").addEventListener("click",(function(){anzhiyu.scrollToDest(0,500),rm.hideRightMenu()})),document.getElementById("menu-translate").addEventListener("click",(function(){window.translateFn.translatePage(),rm.hideRightMenu()})),document.querySelectorAll(".menu-link").forEach((function(e){e.addEventListener("click",rm.hideRightMenu)})),document.getElementById("menu-home")&&document.getElementById("menu-home").addEventListener("click",(function(){window.location.href=window.location.origin})),document.getElementById("menu-randomPost").addEventListener("click",(function(){toRandomPost()})),document.getElementById("menu-commentBarrage").addEventListener("click",anzhiyu.switchCommentBarrage),document.getElementById("rightmenu-mask").addEventListener("click",rm.hideRightMenu),document.getElementById("rightmenu-mask").addEventListener("contextmenu",(function(e){rm.hideRightMenu(),e.preventDefault()})),document.getElementById("menu-copy").addEventListener("click",(()=>{rm.copyPageUrl()})),document.getElementById("menu-pastetext").addEventListener("click",rm.pasteText),document.getElementById("menu-copytext").addEventListener("click",(function(){rm.rightmenuCopyText(selectTextNow);var e=GLOBAL_CONFIG.copyright;e.copy&&anzhiyu.snackbarShow(e.languages.copySuccess)})),document.getElementById("menu-commenttext").addEventListener("click",(function(){rm.rightMenuCommentText(selectTextNow)})),document.getElementById("menu-newwindow").addEventListener("click",(function(){window.open(domhref,"_blank"),rm.hideRightMenu()})),document.getElementById("menu-copylink").addEventListener("click",rm.copyLink),document.getElementById("menu-downloadimg").addEventListener("click",(function(){anzhiyu.downloadImage(domImgSrc,"anzhiyu")})),document.getElementById("menu-newwindowimg").addEventListener("click",(function(){window.open(domImgSrc,"_blank"),rm.hideRightMenu()})),document.getElementById("menu-copyimg").addEventListener("click",(function(){rm.writeClipImg(domImgSrc)})),document.getElementById("menu-searchBaidu").addEventListener("click",rm.searchBaidu),document.getElementById("menu-music-toggle").addEventListener("click",anzhiyu.musicToggle),document.getElementById("menu-music-back").addEventListener("click",anzhiyu.musicSkipBack),document.getElementById("menu-music-forward").addEventListener("click",anzhiyu.musicSkipForward),document.getElementById("menu-music-copyMusicName").addEventListener("click",(function(){rm.rightmenuCopyText(anzhiyu.musicGetName()),anzhiyu.snackbarShow("复制歌曲名称成功",!1,3e3)}))}document.onmouseup=document.ondblclick=selceText,rm.readClipboard=function(){navigator.clipboard&&navigator.clipboard.readText().then((e=>rm.insertAtCaret(globalEvent.target,e)))},rm.insertAtCaret=function(e,t){var n,i=e.selectionStart,o=e.selectionEnd;document.selection?(e.focus(),document.selection.createRange().text=t,e.focus()):i||"0"==i?(n=e.scrollTop,e.value=e.value.substring(0,i)+t+e.value.substring(o,e.value.length),e.focus(),e.selectionStart=i+t.length,e.selectionEnd=i+t.length,e.scrollTop=n):(e.value+=t,e.focus())},rm.pasteText=function(){rm.readClipboard(),rm.hideRightMenu()},rm.rightMenuCommentText=function(e){rm.hideRightMenu();var t=document.getElementById("post-comment").offsetTop;window.scrollTo(0,t-80),"undefined"!=e&&"null"!=e||(e="好棒！"),function t(){setTimeout((()=>{var n=document.getElementsByClassName("el-textarea__inner")[0],i=(n||t(),document.createEvent("HTMLEvents")),o=(i.initEvent("input",!0,!0),replaceAll(e,"\n","\n> "));n.value="> "+o+"\n\n",n.dispatchEvent(i),n.focus(),n.setSelectionRange(-1,-1),document.getElementById("comment-tips")&&document.getElementById("comment-tips").classList.add("show")}),100)}()},rm.searchBaidu=function(){anzhiyu.snackbarShow("即将跳转到百度搜索",!1,2e3),setTimeout((function(){window.open("https://www.baidu.com/s?wd="+selectTextNow)}),"2000"),rm.hideRightMenu()},rm.copyLink=function(){rm.rightmenuCopyText(domhref),anzhiyu.snackbarShow("已复制链接地址")},addRightMenuClickEvent();